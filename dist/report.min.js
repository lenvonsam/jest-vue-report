"use strict";function readFile(){loadJson("./img.json",function(s){loadJson("./testResultData.json",function(t){printReport(s.names,t)})})}function zoomImageCompt(){Vue.component("zoomImage",{props:{imgUrl:{type:String,default:!0}},data:function(){return{zoom:!1,orginx:0,originy:0}},methods:{toggle:function(){var t=this.$refs.zoomImg.getBoundingClientRect();this.originx=t.x+t.width/2,this.originy=t.y+t.height/2,this.zoom=!this.zoom}},render:function(t){return t("div",{class:"zoom-img"},[t("img",{attrs:{src:this.imgUrl},ref:"zoomImg",style:{width:"100px",height:"100px"},on:{click:this.toggle}}),t("div",{class:{"img-dialog":!0,show:this.zoom},style:{transformOrigin:this.originx+"px "+this.originy+"px"},on:{click:this.toggle}},[t("img",{attrs:{src:this.imgUrl}})])])}})}function defineAccordCompt(){Vue.component("accord",{props:{title:{type:String,default:"TEST LOGGER"},status:{stype:null,default:!1},duration:{type:null,default:!1},hasChildren:{type:Boolean,default:!1}},data:function(){return{switch:!1,height:0}},methods:{toggle:function(){if(this.hasChildren){if(this.switch=!this.switch,this.switch){for(var t=0,s=0;s<this.$refs.testScroll.childNodes.length;s++){t+=this.$refs.testScroll.childNodes[s].offsetHeight}this.$refs.testContent.style.height=t+15<=300?t+15+"px":"300px"}else this.$refs.testContent.style.height="0px";this.$forceUpdate()}}},render:function(t){var s=[];this.hasChildren&&s.push(t("i",{class:{"accord-mark iconfont icon-arrow-right-copy-copy":!0,down:this.switch}}));var i=[];return 0<=this.duration&&!1!==this.duration&&(i=[t("div",{class:"test-lbl time"},this.duration+" ms")]),t("div",{class:"accord border-bottom-line ft-gray"},[t("div",{class:{"row padding center":!0,hover:this.hasChildren},on:{click:this.toggle}},[t("div",{class:"col-50"},s),t("div",{class:"col"},[t("i",{class:{"iconfont icon-right ft-pass":"passed"===this.status,"iconfont icon-guanbi ft-fail":"failed"===this.status,"mr-5":this.status}}),t("span",this.title)]),t("div",{class:{"col-100 text-right":!0,hide:0===i.length}},i)]),t("div",{class:{content:!0,show:this.switch},ref:"testContent"},[t("div",{class:"scroll",ref:"testScroll"},this.$slots.default)])])}})}function printReport(s,i){zoomImageCompt(),defineAccordCompt();new Vue({el:"#appTest",render:function(t){return t("div",{class:"test-container"},[t("div",{class:"title"},"前端自动化测试报告"),getReportHeader(t,i),getReportBody(t,i.testResults,s)])}})}function getReportBody(s,t,i){var e=[];return t.map(function(t){e.push(getRowItem(s,t,i))}),s("div",{class:"full-width"},e)}function getRowItem(t,s,i){var e=s.testResults[0].title;0<s.testResults[0].ancestorTitles.length&&(e=s.testResults[0].ancestorTitles[0]);var o=s.numFailingTests+s.numPassingTests+s.numPendingTests,n=(s.numPassingTests/o*100).toFixed(2),a=s.perfStats.end-s.perfStats.start;return t("div",{class:"box border ft-gray border-bottom-0"},[t("div",{class:"row padding border-bottom-line"},[t("div",{class:"col-50 ft-pass"},[t("i",{class:"iconfont icon-right"})]),t("div",{class:"col"},e),t("div",{class:"col-100 text-right"},n+"%")]),t("div",{class:"row padding ft-12"},[t("div",{class:"col-50"}),t("div",{class:"col"},s.testFilePath)]),t("div",{class:"row padding pt-0 ft-12"},[t("div",{class:"col-50"}),t("div",{class:"col"},[t("i",{class:"iconfont icon-shijian ft-12 mr-5"}),t("span",a+"ms")]),t("div",{class:"col"},[t("i",{class:"iconfont icon-quanbu ft-12 mr-5"}),t("span",o)]),t("div",{class:"col"},[t("i",{class:"iconfont icon-right ft-pass ft-12 mr-5"}),t("span",s.numPassingTests)]),t("div",{class:"col"},[t("i",{class:"iconfont icon-guanbi ft-fail ft-12 mr-5"}),t("span",s.numFailingTests)])]),getSubItem(t,s.testResults,i),getTestLog(t,s.console)])}function getSubItem(n,t,a){var r=[];return t.map(function(s){var t=a.filter(function(t){return t.split("_")[1]===sha1(s.title)});if(0===t.length)if("passed"===s.status)r.push(n("accord",{props:{title:s.title,status:s.status,hasChildren:!1,duration:s.duration}}));else{var i=[],e=[];s.failureMessages.map(function(t){var s=t.replace(/\n/g,"<br>");s=s.replace(/\[[0-9]+m/g,""),e.push(n("li",[n("div",{style:{lineHeight:"26px"},domProps:{innerHTML:s}})]))}),i.push(n("ul",e)),r.push(n("accord",{props:{title:s.title,status:s.status,hasChildren:!0,duration:s.duration}},i))}else{var o=[];t.map(function(t){o.push(n("zoom-image",{props:{imgUrl:"./assets/"+t}}))}),r.push(n("accord",{props:{title:s.title,status:s.status,hasChildren:!0,duration:s.duration}},o))}}),n("div",r)}function getTestLog(s,t){var i=[];if(0<t.length){var e=[];t.map(function(t){e.push(s("li",{class:"padding"},[s("div",{class:"ft-12",style:{color:"#888"}},t.type+" > "+t.origin),s("div",{style:{paddingLeft:"10px",marginTop:"10px",lineHeight:"25px"}},t.message)]))}),i.push(s("ul",e))}return 0===t.length?s("div",{},i):s("accord",{props:{hasChildren:!0}},i)}function getReportHeader(o,n){var a=["startTime","numTotalTestSuites","numTotalTests","numPassedTests","numFailedTests"],r=[],l=[],c=[];return["TIME","SUITE","TESTS","PASSED","FAIED"].map(function(t,s){r.push(o("div",{class:"col"},t));var i=n[a[s]];if("TIME"===t&&(i=formateDate(i)),"PASSED"===t){l.push(o("div",{class:"col ft-pass"},i));var e=(i/n.numTotalTests*100).toFixed(2);c.push(o("div",{class:"col"},[o("div",{class:"test-lbl pass"},e+"% Passing")]))}else if("FAIED"===t){l.push(o("div",{class:"col ft-fail"},i));e=(i/n.numTotalTests*100).toFixed(2);c.push(o("div",{class:"col"},[o("div",{class:"test-lbl fail"},e+"% Failed")]))}else l.push(o("div",{class:"col"},i)),c.push(o("div",{class:"col"},""))}),o("div",{class:"box text-center border"},[o("div",{class:"row padding border-bottom-line ft-gray"},r),o("div",{class:"row padding ft-dark-gray"},l),o("div",{class:"row padding pt-0"},c)])}function formateNumber(t){return 9<t?""+t:"0"+t}function formateDate(t){var s=new Date(t),i=s.getFullYear(),e=s.getMonth()+1,o=s.getDate(),n=s.getHours(),a=s.getMinutes(),r=s.getSeconds();return[i,e,o].map(formateNumber).join("-")+" "+[n,a,r].map(formateNumber).join(":")}function loadJson(t,s){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&s(JSON.parse(i.responseText))},i.send(null)}document.body.onload=readFile();