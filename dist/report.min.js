"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function readFile(){console.log("readFile:>>"+sha1("should login with failure")),loadJson("../vueReport/img.json",function(s){loadJson("../vueReport/testResultData.json",function(t){console.log(t),printReport(s.names,t)})})}function zoomImageCompt(){Vue.component("zoomImage",{props:{imgUrl:{type:String,default:!0}},data:function(){return{zoom:!1,orginx:0,originy:0}},methods:{toggle:function(){var t=this.$refs.zoomImg.getBoundingClientRect();this.originx=t.x+t.width/2,this.originy=t.y+t.height/2,this.zoom=!this.zoom}},render:function(t){return t("div",{class:"zoom-img"},[t("img",{attrs:{src:this.imgUrl},ref:"zoomImg",style:{width:"100px",height:"100px"},on:{click:this.toggle}}),t("div",{class:{"img-dialog":!0,show:this.zoom},style:{transformOrigin:this.originx+"px "+this.originy+"px"},on:{click:this.toggle}},[t("img",{attrs:{src:this.imgUrl}})])])}})}function defineAccordCompt(){Vue.component("accord",{props:{title:{type:String,default:"TEST LOGGER"},status:{stype:null,default:!1},duration:{type:null,default:!1},hasChildren:{type:Boolean,default:!1}},data:function(){return{switch:!1,height:0}},methods:{toggle:function(){if(this.hasChildren){if(this.switch=!this.switch,this.switch){for(var t=0,s=0;s<this.$refs.testScroll.childNodes.length;s++){t+=this.$refs.testScroll.childNodes[s].offsetHeight}this.$refs.testContent.style.height=t+15<=300?t+15+"px":"300px"}else this.$refs.testContent.style.height="0px";this.$forceUpdate()}}},render:function(t){var s=[];this.hasChildren&&s.push(t("i",{class:{"accord-mark iconfont icon-arrow-right-copy-copy":!0,down:this.switch}}));var e=[];return 0<=this.duration&&!1!==this.duration&&(e=[t("div",{class:"test-lbl time"},this.duration+" ms")]),t("div",{class:"accord border-bottom-line ft-gray"},[t("div",{class:{"row padding center":!0,hover:this.hasChildren},on:{click:this.toggle}},[t("div",{class:"col-50"},s),t("div",{class:"col"},[t("i",{class:{"iconfont icon-right ft-pass":"passed"===this.status,"iconfont icon-guanbi ft-fail":"failed"===this.status,"mr-5":this.status}}),t("span",this.title)]),t("div",{class:{"col-100 text-right":!0,hide:0===e.length}},e)]),t("div",{class:{content:!0,show:this.switch},ref:"testContent"},[t("div",{class:"scroll",ref:"testScroll"},this.$slots.default)])])}})}function printReport(s,e){zoomImageCompt(),defineAccordCompt();new Vue({el:"#appTest",render:function(t){return t("div",{class:"test-container"},[t("div",{class:"title"},"前端自动化测试报告"),getReportHeader(t,e),getReportBody(t,e.testResults,s)])}})}function getReportBody(s,t,e){var o=[];return t.map(function(t){o.push(getRowItem(s,t,e))}),s("div",{class:"full-width"},o)}function getRowItem(t,s,e){var o=s.testResults[0].title;0<s.testResults[0].ancestorTitles.length&&(o=s.testResults[0].ancestorTitles[0]);var i=s.numFailingTests+s.numPassingTests+s.numPendingTests,n=(s.numPassingTests/i*100).toFixed(2),a=s.perfStats.end-s.perfStats.start;return t("div",{class:"box border ft-gray border-bottom-0"},[t("div",{class:"row padding border-bottom-line"},[t("div",{class:"col-50 ft-pass"},[t("i",{class:"iconfont icon-right"})]),t("div",{class:"col"},o),t("div",{class:"col-100 text-right"},n+"%")]),t("div",{class:"row padding ft-12"},[t("div",{class:"col-50"}),t("div",{class:"col"},s.testFilePath)]),t("div",{class:"row padding pt-0 ft-12"},[t("div",{class:"col-50"}),t("div",{class:"col"},[t("i",{class:"iconfont icon-shijian ft-12 mr-5"}),t("span",a+"ms")]),t("div",{class:"col"},[t("i",{class:"iconfont icon-quanbu ft-12 mr-5"}),t("span",i)]),t("div",{class:"col"},[t("i",{class:"iconfont icon-right ft-pass ft-12 mr-5"}),t("span",s.numPassingTests)]),t("div",{class:"col"},[t("i",{class:"iconfont icon-guanbi ft-fail ft-12 mr-5"}),t("span",s.numFailingTests)])]),getSubItem(t,s.testResults,e),getTestLog(t,s.console)])}function getSubItem(n,t,a){var l=[];return t.map(function(s){var t=a.filter(function(t){return t.split("_")[1]===sha1(s.title)});if(0===t.length)if("passed"===s.status)l.push(n("accord",{props:{title:s.title,status:s.status,hasChildren:!1,duration:s.duration}}));else{var e=[],o=[];s.failureMessages.map(function(t){var s=t.replace(/\n/g,"<br>");s=s.replace(/\[[0-9]+m/g,""),o.push(n("li",[n("div",{style:{lineHeight:"26px"},domProps:{innerHTML:s}})]))}),e.push(n("ul",o)),l.push(n("accord",{props:{title:s.title,status:s.status,hasChildren:!0,duration:s.duration}},e))}else{var i=[];t.map(function(t){i.push(n("zoom-image",{props:{imgUrl:"./assets/"+t}}))}),l.push(n("accord",{props:{title:s.title,status:s.status,hasChildren:!0,duration:s.duration}},i))}}),n("div",l)}function getTestLog(s,t){var e=[];if(console.log(t),0<t.length){var o=[];t.map(function(t){o.push(s("li",{class:"padding"},[s("div",{class:"ft-12",style:{color:"#888"}},t.type+" > "+t.origin),s("div",{style:{paddingLeft:"10px",marginTop:"10px",lineHeight:"25px"}},t.message)]))}),e.push(s("ul",o))}return 0===t.length?s("div",{},e):s("accord",{props:{hasChildren:!0}},e)}function getReportHeader(i,n){var a=["startTime","numTotalTestSuites","numTotalTests","numPassedTests","numFailedTests"],l=[],r=[],c=[];return["TIME","SUITE","TESTS","PASSED","FAIED"].map(function(t,s){l.push(i("div",{class:"col"},t));var e=n[a[s]];if("TIME"===t&&(e=formateDate(e)),"PASSED"===t){r.push(i("div",{class:"col ft-pass"},e));var o=(e/n.numTotalTests*100).toFixed(2);c.push(i("div",{class:"col"},[i("div",{class:"test-lbl pass"},o+"% Passing")]))}else if("FAIED"===t){r.push(i("div",{class:"col ft-fail"},e));o=(e/n.numTotalTests*100).toFixed(2);c.push(i("div",{class:"col"},[i("div",{class:"test-lbl fail"},o+"% Failed")]))}else r.push(i("div",{class:"col"},e)),c.push(i("div",{class:"col"},""))}),i("div",{class:"box text-center border"},[i("div",{class:"row padding border-bottom-line ft-gray"},l),i("div",{class:"row padding ft-dark-gray"},r),i("div",{class:"row padding pt-0"},c)])}function formateNumber(t){return 9<t?""+t:"0"+t}function formateDate(t){console.log(t),console.log(void 0===t?"undefined":_typeof(t));var s=new Date(t),e=s.getFullYear(),o=s.getMonth()+1,i=s.getDate(),n=s.getHours(),a=s.getMinutes(),l=s.getSeconds();return[e,o,i].map(formateNumber).join("-")+" "+[n,a,l].map(formateNumber).join(":")}function loadJson(t,s){console.log("loadjson");var e=new XMLHttpRequest;e.overrideMimeType("application/json"),e.open("GET",t,!0),e.onreadystatechange=function(){console.log(e.status),4===e.readyState&&200===e.status&&s(JSON.parse(e.responseText))},e.send(null)}document.body.onload=readFile();