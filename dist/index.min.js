"use strict";var packageJson=require(process.env.PWD+"/package.json"),sha1=require("sha1"),fs=require("fs-extra");function getRootPath(){return packageJson["jest-vue-report"]&&packageJson["jest-vue-report"]["report-site"]?packageJson["jest-vue-report"]["report-site"]:process.env.PWD+"/test/jestReport"}function copy2ImgJson(e,n){var r=e+"/img.json";fs.pathExists(r,function(e,t){t?fs.readJson(r,function(e,t){if(e)console.error(e);else{var s=t.names,o=s.findIndex(function(e){return e.split("_")[1]===n.split("_")[1]});o<0?s.push(n):s[o]=n,fs.writeJson(r,{names:s})}}):fs.outputJson(r,{names:[n]})})}function getIndexHtml(){return'<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta name="renderer" content="webkit"><title>自动化测试报告</title><link href="http://at.alicdn.com/t/font_668771_1rzkn8yfei2j4i.css" rel="stylesheet"></link><link href="index.min.css" rel="stylesheet"></link></head><body><div id="appTest"></div><script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"><\/script><script src="https://cdn.bootcss.com/js-sha1/0.6.0/sha1.min.js"><\/script><script src="report.min.js"><\/script></body></html>'}function jestReporter(e){var t=getRootPath(),s=t+"/img.json";return fs.pathExists(s,function(e,t){t||fs.outputJson(s,{names:[]})}),console.log(">>>>>>>>>"+process.env.PWD),fs.copy(process.env.PWD+"/node_modules/jest-vue-report/dist/index.min.css",t+"/index.min.css"),fs.copy(process.env.PWD+"/node_modules/jest-vue-report/dist/report.min.js",t+"/report.min.js"),fs.outputFile(t+"/index.html",getIndexHtml()),fs.outputJson(t+"/testResultData.json",e),console.log('Build Jest Vue Report complete in "'+getRootPath()+'" folder'),console.log("Built files are meant to be served over an HTTP server."),console.log("Opening index.html over file:// won't work."),e}jestReporter.getScreenshotUrl=function(e){if(e){var t=getRootPath();fs.ensureDirSync(t+"/assets");var s=(new Date).getTime(),o="img_"+sha1(e)+"_"+s+".png";return copy2ImgJson(t,o),t+"/assets/"+o}return""},module.exports=jestReporter;